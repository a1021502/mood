<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¦ç§‘å¿ƒéˆæ¨¹æ´ğŸŒ±</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#8ba7d6">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('Service Worker Registered'))
      .catch((err) => console.log('SW Error:', err));
  }
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Zen+Maru+Gothic:wght@500;700;900&display=block" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  /* === æ ¸å¿ƒè®Šæ•¸èˆ‡è‰²å½©ç³»çµ± === */
  :root {
    --primary: #8ba7d6;          /* ä¸»è‰²èª¿ï¼šç™‚ç™’è— */
    --primary-hover: #7695c9;
    --accent: #f4a261;           /* å¼·èª¿è‰²ï¼šæº«æš–æ©˜ */
    --text-main: #4a5568;        /* æ·±ç°æ–‡å­— */
    --glass-bg: rgba(255, 255, 255, 0.75);
    --glass-border: rgba(255, 255, 255, 0.8);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    --font-main: 'Zen Maru Gothic', sans-serif;
    --font-hand: 'Caveat', cursive;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: var(--font-main);
    background: linear-gradient(-45deg, #e0c3fc, #8ec5fc, #e0c3fc, #cfdef3);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    color: var(--text-main);
    overflow-x: hidden;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* === UI å…ƒä»¶æ¨£å¼ === */
  .card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 35px;
    padding: 2.5rem;
    box-shadow: var(--glass-shadow);
    width: 100%;
    max-width: 550px;
    position: relative;
    margin-top: 20px;
    transition: all 0.5s ease;
    animation: floatIn 0.8s cubic-bezier(0.22, 1, 0.36, 1);
  }

  @keyframes floatIn {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h2 {
    color: #2d3748;
    text-align: center;
    margin-bottom: 8px;
    font-size: 1.8rem;
    font-weight: 900;
    letter-spacing: 1px;
    text-shadow: 2px 2px 0px rgba(255,255,255,0.6);
  }

  .subtitle {
    text-align: center;
    color: #718096;
    margin-bottom: 30px;
    font-size: 1.05rem;
    font-weight: 500;
  }

  input[type="text"], textarea {
    width: 100%;
    padding: 16px;
    border: 2px solid transparent;
    border-radius: 20px;
    font-size: 1.1rem;
    font-family: var(--font-main);
    background: rgba(255,255,255,0.6);
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.03);
    margin-bottom: 18px;
    transition: 0.3s;
    outline: none;
    color: #4a5568;
  }

  input[type="text"]:focus, textarea:focus {
    background: #fff;
    border-color: var(--primary);
    box-shadow: 0 0 0 5px rgba(139, 167, 214, 0.15);
    transform: translateY(-2px);
  }

  /* æŒ‰éˆ•æ¨£å¼ */
  .btn-action {
    width: 100%;
    background: linear-gradient(135deg, var(--primary) 0%, #a3bded 100%);
    color: white;
    border: none;
    padding: 18px;
    border-radius: 20px;
    font-size: 1.25rem;
    font-weight: 700;
    font-family: var(--font-main);
    cursor: pointer;
    margin-top: 25px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 10px 20px -5px rgba(139, 167, 214, 0.5);
    position: relative;
    overflow: hidden;
  }
  .btn-action:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 15px 30px -5px rgba(139, 167, 214, 0.6); }
  .btn-action:active { transform: translateY(-1px) scale(0.98); }
  .btn-action:disabled { opacity: 0.6; transform: none; cursor: not-allowed; }

  .btn-secondary { background: #e2e8f0; color: #4a5568; box-shadow: none; }
  .btn-secondary:hover { background: #cbd5e0; }

  .btn-danger {
    background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
    box-shadow: 0 10px 20px -5px rgba(252, 129, 129, 0.5);
  }

  /* æƒ…ç·’æŒ‰éˆ• */
  .emotion-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
  .btn-mood {
    background: rgba(255,255,255,0.7); border: 2px solid white; border-radius: 25px; padding: 10px;
    cursor: pointer; transition: all 0.4s; text-align: center;
    display: flex; flex-direction: column; align-items: center; justify-content: center; height: 125px;
  }
  .btn-mood:hover { transform: translateY(-8px) scale(1.05); background: white; border-color: var(--primary); }
  .btn-mood.selected { border-color: var(--primary); background: #ebf8ff; color: #2b6cb0; transform: scale(1.05); }
  .emoji-icon { font-size: 3rem; margin-bottom: 8px; filter: drop-shadow(0 3px 3px rgba(0,0,0,0.1)); }

  /* æ»‘æ¡¿ */
  input[type="range"] {
    -webkit-appearance: none; width: 100%; height: 12px; border-radius: 10px;
    background: #e2e8f0; outline: none; margin: 15px 0;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 26px; height: 26px; border-radius: 50%;
    background: #fff; border: 4px solid var(--primary); cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: transform 0.2s;
  }
  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  /* ç¢ç´™æ©Ÿæ¨£å¼ */
  .shredder-box {
    background: rgba(255, 240, 240, 0.8); padding: 20px; border-radius: 25px;
    border: 2px dashed #fc8181; margin-top: 25px;
  }
  .btn-shred {
    background: #fc8181; color: white; padding: 10px 20px; border-radius: 50px;
    border: none; cursor: pointer; float: right; margin-top: 10px; font-weight: bold;
    box-shadow: 0 4px 10px rgba(252, 129, 129, 0.3); transition: 0.3s;
  }
  .btn-shred:hover { background: #e53e3e; transform: scale(1.05); }

  #shredder-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(40, 44, 52, 0.98); z-index: 10000; display: none;
    flex-direction: column; align-items: center; justify-content: center; overflow: hidden;
  }

  .paper-sheet {
    position: absolute; top: 50px; width: 260px; min-height: 200px;
    background: #fff; padding: 25px; box-sizing: border-box;
    font-family: 'Caveat', cursive !important; /* å¼·åˆ¶æ‰‹å¯«é«” */
    color: #2d3748; font-size: 1.8rem; line-height: 1.3; font-weight: 700;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 50; text-align: center;
    border-radius: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    transform: translateY(0); opacity: 1;
    transition: transform 4s linear, opacity 4s ease-in;
  }

  .shredder-body {
    position: relative; width: 320px; height: 80px; background: #2d3748;
    border-radius: 10px; box-shadow: 0 -5px 15px rgba(0,0,0,0.5); z-index: 100;
    border-top: 4px solid #4a5568; display: flex; justify-content: center; align-items: center; margin-top: 150px;
  }
  .shredder-slot { width: 280px; height: 10px; background: #1a202c; border-radius: 5px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.8); }
  .led-light { width: 10px; height: 10px; background: #e53e3e; border-radius: 50%; position: absolute; right: 15px; top: 10px; box-shadow: 0 0 5px #e53e3e; }
  .led-light.active { background: #48bb78; box-shadow: 0 0 10px #48bb78; animation: blink 0.1s infinite; }
  @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

  /* ç¢ç´™å‹•ç•«ç‹€æ…‹ */
  .paper-sheet.shredding { transform: translateY(450px); opacity: 0; }
  .shred-strip { position: absolute; top: 330px; width: 6px; background: #fff; z-index: 90; opacity: 0; }
  @keyframes fallStrip {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(400px) rotate(var(--rot)); opacity: 0; }
  }

  /* === å…¨è¢å¹•æ„Ÿè¬ === */
  #final-thank-you-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, rgba(139, 167, 214, 0.95), rgba(244, 162, 97, 0.9));
    z-index: 10002; display: none; align-items: center; justify-content: center;
    backdrop-filter: blur(10px); animation: fadeInOverlay 0.5s ease;
  }
  .final-card {
    background: white; width: 85%; max-width: 400px; padding: 40px;
    border-radius: 40px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  @keyframes fadeInOverlay { from{opacity:0;} to{opacity:1;} }
  @keyframes popIn { from{transform: scale(0.5); opacity: 0;} to{transform: scale(1); opacity: 1;} }

  /* æˆåŠŸå½ˆçª— (ç¢ç´™æ©Ÿç”¨) */
  #success-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
  .success-box { background: white; width: 85%; max-width: 350px; padding: 30px; border-radius: 30px; text-align: center; animation: popIn 0.5s; }

  /* éŸ³æ¨‚æ‡¸æµ®éˆ• */
  .music-control {
    position: fixed; top: 25px; right: 25px; background: rgba(255,255,255,0.85);
    width: 45px; height: 45px; display: flex; align-items: center; justify-content: center;
    border-radius: 50%; cursor: pointer; z-index: 1000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1); backdrop-filter: blur(5px);
    transition: all 0.3s; font-size: 1.2rem; border: 2px solid white;
  }
  .music-control:hover { transform: scale(1.1) rotate(15deg); }

  /* RWD & Steps */
  .step { display: none; animation: slideUp 0.5s ease; }
  .step.active { display: block; }
  @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  .progress-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 35px; }
  .dot { width: 10px; height: 10px; background: rgba(203, 213, 224, 0.5); border-radius: 50%; transition: 0.3s; }
  .dot.active { background: var(--primary); transform: scale(1.4); }

  /* Admin */
  .admin-panel { display: none; width: 95%; max-width: 800px; background: white; padding: 25px; margin-top: 20px; border-radius: 20px; z-index: 2000; box-shadow: 0 10px 50px rgba(0,0,0,0.2); }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; font-size: 0.9rem; }
  .high-risk-row { background: #fff5f5; color: #c53030; font-weight: bold; }
  
  #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(50,50,50,0.9); color: white; padding: 12px 24px; border-radius: 50px; display: none; z-index: 9999; font-size: 0.9rem; backdrop-filter: blur(4px); }
  #toast.show { display: block; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from{opacity:0; transform: translate(-50%, 10px);} to{opacity:1; transform: translate(-50%, 0);} }
</style>
</head>
<body>

<div id="shredder-overlay">
  <div id="paper-to-shred" class="paper-sheet" style="font-family: 'Caveat', cursive;"></div>
  
  <div class="shredder-body">
    <div class="shredder-slot"></div>
    <div id="shredder-light" class="led-light"></div>
  </div>
  <h3 style="position: absolute; bottom: 100px; color: #a0aec0; opacity: 0.8; z-index: 120;">æ­£åœ¨ç²‰ç¢é‚£äº›ç…©äººçš„æƒ³æ³•...</h3>
</div>

<div id="success-overlay">
  <div class="success-box">
    <div style="font-size: 4rem; margin-bottom: 10px;">âœ¨</div>
    <h2 style="color:var(--primary); margin:0; font-size:1.5rem;">ç…©æƒ±å·²ç²‰ç¢ï¼</h2>
    <p style="color:#718096; line-height:1.6; font-size:1rem; margin-top:10px;">
      é‚£äº›æƒ¡é­”å·²ç¶“æ¶ˆå¤±äº†ï¼<br>æ·±å‘¼å¸ï¼Œä½ ç¾åœ¨å¾ˆå®‰å…¨ã€‚ğŸƒ
    </p>
    <button class="btn-action" style="margin-top:20px; padding:12px;" onclick="document.getElementById('success-overlay').style.display='none'">å¤ªå¥½äº†</button>
  </div>
</div>

<div id="final-thank-you-overlay">
  <div class="final-card">
    <div style="font-size: 4rem; margin-bottom: 15px;">ğŸ’Œ</div>
    <h2 style="color: #4a5568; margin: 0 0 10px 0;">è¨Šæ¯å·²é€é”</h2>
    <p style="color: #718096; line-height: 1.6; margin-bottom: 25px;">
      è¬è¬ä½ é¡˜æ„åˆ†äº«ã€‚<br>
      ç„¡è«–ä»Šå¤©éå¾—å¦‚ä½•ï¼Œ<br>
      ä½ éƒ½åšå¾—å·²ç¶“å¤ å¥½äº†ğŸ˜
    </p>
    <button class="btn-action" onclick="location.reload()">é—œé–‰è¦–çª— (é‡æ–°é–‹å§‹)</button>
  </div>
</div>

<div class="music-control" onclick="forcePlayMusic()" title="æ’­æ”¾/æš«åœéŸ³æ¨‚">
  <span id="music-icon">ğŸ”‡</span>
</div>
<audio id="bgm" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3" type="audio/mpeg">
</audio>

<div id="toast">æç¤ºè¨Šæ¯</div>

<div class="card">
  <div class="progress-container">
    <div class="dot active" id="dot-0"></div>
    <div class="dot" id="dot-1"></div>
    <div class="dot" id="dot-2"></div>
    <div class="dot" id="dot-3"></div>
  </div>

  <div id="step-0" class="step active">
    <h2>ğŸŒ± æ­¡è¿ä¾†åˆ°ç¦ç§‘å¿ƒéˆæ¨¹æ´</h2>
    <p class="subtitle">æ”¾æ…¢è…³æ­¥ï¼Œå‘Šè¨´æˆ‘å€‘ä½ æƒ³èªªçš„å§~</p>
    <div style="background:rgba(255,255,255,0.5); padding:20px; border-radius:20px; margin-bottom:25px; color:#5a67d8; font-size:0.95rem; border:1px solid rgba(255,255,255,0.8);">
      <i class="fas fa-headphones-alt"></i> <b>å°æé†’ï¼š</b><br>
      å»ºè­°æˆ´ä¸Šè€³æ©Ÿï¼Œé«”é©—æœƒæ›´å¥½å–”ã€‚<br>
      å…§å®¹åªæœ‰è€å¸«çœ‹å¾—åˆ°ï¼Œè«‹æ”¾å¿ƒã€‚
    </div>
    <input type="text" id="sid" inputmode="numeric" placeholder="è«‹è¼¸å…¥ç­ç´šåº§è™Ÿ (ä¾‹: 80512)">
    <input type="text" id="sname" placeholder="æ€éº¼ç¨±å‘¼ä½ å‘¢ï¼Ÿ">
    <button class="btn-action" onclick="startCheck()">æº–å‚™å¥½äº†ï¼Œé–‹å§‹</button>
  </div>

  <div id="step-1" class="step">
    <h2 id="greeting-text">ç¾åœ¨çš„æ„Ÿè¦ºåƒä»€éº¼ï¼Ÿ</h2>
    <p class="subtitle">è·Ÿéš¨ä½ çš„ç›´è¦ºé¸ä¸€å€‹</p>
    <div class="emotion-grid" id="emotion-grid"></div>
    <button class="btn-action btn-secondary" style="margin-top:20px;" onclick="switchStep(0)">å›ä¸Šä¸€é </button>
  </div>

  <div id="step-2" class="step">
    <h2 id="step2-title">ä»Šæ—¥æ°£è±¡ï¼šæœªçŸ¥</h2>
    
    <div style="background:rgba(255,255,255,0.5); padding:20px; border-radius:20px; text-align:center; margin-bottom:20px; border:2px solid rgba(0, 0, 0, 0.103);">
      <div id="slider-text" style="font-size:1.2rem; font-weight:bold; color:var(--primary); transition:0.3s;">å¿ƒæƒ…å¼·åº¦ï¼š5 (é‚„å¥½)</div>
      <input type="range" id="intensity" min="1" max="10" value="5" oninput="updateSlider(this.value)">
      <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#a0aec0; margin-top:5px;">
        <span>â˜ï¸ æ·¡æ·¡çš„</span><span>âš¡ å¼·çƒˆé›·é›¨</span>
      </div>
    </div>

    <div style="background:rgba(255, 250, 240, 0.9); padding:25px; border-radius:25px; text-align:center; margin-bottom:20px; border:2px dashed #f6e05e;">
      <p id="battery-title" style="font-weight:bold; margin-bottom:5px; color:#d69e2e;">âš¡ èº«é«”èƒ½é‡é›»æ±  (é«”åŠ›)ï¼š</p>
      <div style="display:flex; justify-content:center; margin:10px 0;">
        <div style="width:120px; height:40px; border:3px solid #4a5568; border-radius:10px; padding:3px; position:relative; background:white; display:inline-block;">
          <div id="battery-fill" style="height:100%; width:50%; background:#48bb78; border-radius:5px; transition:width 0.3s ease, background-color 0.3s ease;"></div>
          <div style="position:absolute; right:-7px; top:10px; width:5px; height:14px; background:#4a5568; border-radius:0 3px 3px 0;"></div>
        </div>
      </div>
      <div id="battery-text" style="font-weight:bold; color:#48bb78;">50%</div>
      <input type="range" id="battery-level" min="0" max="100" value="50" step="10" oninput="updateBattery(this.value)">
    </div>

    <div style="margin-top:25px;">
      <p style="font-weight:bold; color:var(--primary); margin-bottom:8px;">ğŸ’¡ ç•¶ä¸‹çš„å°å°ç·´ç¿’ï¼š</p>
      <p style="color:#718096; margin-top:0; font-size:0.9rem;">ç¾åœ¨åšå“ªä¸€ä»¶<b>å°äº‹</b>ï¼Œå¯ä»¥è®“è‡ªå·±èˆ’æœ 1%ï¼Ÿ</p>
      <textarea id="small-step-note" style="width: 100%;             /* è®“å¯¬åº¦ä½”æ»¿ */
      height: 100px;           /*ç¨å¾®åŠ é«˜ä¸€é»ï¼Œæ›´å¥½å¯«*/
      padding: 12px;           /* å…§è·ï¼Œæ–‡å­—æ‰ä¸æœƒè²¼é‚Š */
      border: 2px solid #7eade2; /* é¡¯çœ¼çš„è—è‰²é‚Šæ¡† */" placeholder="ä¾‹å¦‚ï¼šè¶´ä¸‹ä¾† 5 åˆ†é˜ã€å–æ¯å†°æ°´ã€è½ä¸€é¦–æ­Œ..."></textarea>
    </div>

    <div class="shredder-box">
      <p style="font-weight:bold; margin-bottom:8px; color:#c53030;">ğŸ—‘ï¸ ç…©æƒ±ç¢ç´™æ©Ÿï¼š</p>
      <textarea id="worry-text" style="width:100%; border:none; background:transparent; font-size:1rem; color:#c53030; outline:none; resize:none;" rows="2" placeholder="æŠŠè¨å­çš„æƒ³æ³•æ‰“åœ¨é€™è£¡... (é»æ“Šå³ä¸‹è§’æŒ‰éˆ•ç²‰ç¢å®ƒ)"></textarea>
      <button class="btn-shred" onclick="shredWorry()">ğŸ‘‹ å•Ÿå‹•ç¢ç´™æ©Ÿ</button>
      <div style="clear:both;"></div>
    </div>

    <label style="display:flex; align-items:center; gap:10px; padding:15px; background:rgba(255,255,255,0.8); border-radius:15px; cursor:pointer; margin-top:20px;">
      <input type="checkbox" id="need-talk" style="width:20px; height:20px; accent-color:#e53e3e;"> 
      <span style="font-weight:700; color:#4a5568;">ğŸ™‹ æˆ‘å¸Œæœ›è€å¸«ä¹‹å¾Œæ‰¾æˆ‘èŠèŠ</span>
    </label>

    <div style="display:flex; gap:15px;">
      <button class="btn-action btn-secondary" onclick="switchStep(1)">ä¸Šä¸€æ­¥</button>
      <button class="btn-action" onclick="processStep2()">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <div id="step-3" class="step">
    <h2 style="color:#c53030;">âš ï¸ ç¨å¾®æš«åœä¸€ä¸‹</h2>
    <p class="subtitle">å›æƒ³ä¸€ä¸‹æœ€è¿‘å…©é€± æœ‰ä»¥ä¸‹é€™äº›ç‹€æ³å—ï¼Ÿ</p>
    <div id="risk-list"></div>
    <button class="btn-action btn-danger" onclick="submitRisk()">å®Œæˆæª¢æ¸¬</button>
  </div>

  <div id="step-4" class="step">
    <div id="result-area"></div>
    
    <div style="background:#f0f4f8; border-left:5px solid #76a9fa; padding:15px; margin-top:20px; border-radius:10px;">
      <b>ğŸŒ² ç¥ç§˜æ¨¹æ´ (åŒå­¸çš„æ‚„æ‚„è©±)ï¼š</b>
      <p id="tree-hole-msg" style="margin-top:5px; color:#4a5568; font-style:italic;">Loading...</p>
    </div>

    <div id="vitamin-section" style="perspective:1000px; width:100%; height:160px; cursor:pointer; margin-top:25px;" onclick="drawVitamin()">
      <div class="vitamin-inner" style="position:relative; width:100%; height:100%; text-align:center; transition:transform 0.8s; transform-style:preserve-3d;">
        <div class="vitamin-front" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:20px; box-shadow:0 10px 20px rgba(0,0,0,0.1); border:3px solid #f6e05e; background:#fffaf0;">
          <span style="font-size:3rem;">ğŸ’Š</span>
          <b style="color:#d69e2e; margin-top:10px;">é»æˆ‘æŠ½å–ä»Šæ—¥ã€Œå¿ƒéˆç¶­ä»–å‘½ã€</b>
        </div>
        <div class="vitamin-back" style="position:absolute; width:100%; height:100%; backface-visibility:hidden; transform:rotateY(180deg); background:white; padding:15px; display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:20px; border:3px solid #f6e05e;">
          <div id="vitamin-text" style="font-weight:bold; color:#d69e2e; font-size:1.1rem; line-height:1.5;"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:25px; padding-top:20px; border-top:1px dashed #cbd5e0;">
      <h4 id="final-prompt">ğŸ’¬ é‚„æƒ³è·Ÿè€å¸«èªªä»€éº¼å—ï¼Ÿ</h4>
      <textarea id="final-msg" style="height:80px;" placeholder="é€™è£¡å¯ä»¥å¯«ä»»ä½•ä½ æƒ³èªªçš„ã€æƒ³å•çš„..."></textarea>
      <button class="btn-action" style="padding:12px; font-size:1rem;" onclick="sendFinalMsg(this)">é€å‡ºçµ¦è€å¸« â¤ï¸</button>
    </div>

    <div style="margin-top:30px; text-align:center; color:#a0aec0; font-size:0.85rem;">
      <p>ç¦ç§‘è¼”å°å®¤æ°¸é æ”¯æŒä½ </p>
      <p>è¸¹å…±(å°‘å¹´)å°ˆç·šï¼š 0800-001769 | 24å°æ™‚å®‰å¿ƒå°ˆç·šï¼š1925 | ç”Ÿå‘½ç·šï¼š1995</p>
      <p>å…’ç¦è¯ç›Ÿ LINE@ç·šä¸ŠèŠï¼šåœ¨LINEæœå°‹ @youthline_cwlf
      
    </div>
    <button class="btn-action btn-secondary" onclick="location.reload()" style="margin-top:15px;">é—œé–‰è¦–çª—</button>
  </div>
</div>

<div class="admin-trigger" style="text-align:center; margin-top:20px;">
  <button onclick="toggleAdmin()" style="background:rgba(255,255,255,0.3); border:1px solid white; color:#4a5568; cursor:pointer; padding:5px 15px; border-radius:15px;">[ æœçš®è€å¸«èªªä¸å¯ä»¥é»é€™è£¡ï¼ ]</button>
</div>
<div id="admin-panel" class="admin-panel">
  <h3 style="margin:0 0 15px 0;">ğŸ“Š å­¸ç”Ÿå¿ƒæƒ…æ•¸æ“šåº«<button onclick="downloadCSV()" style="background:#2b6cb0; color:white; border:none; padding:5px 10px; margin-left:10px; border-radius:4px; cursor:pointer;">
  ğŸ“¥ åŒ¯å‡º Excel
</button>
</h3>
  <table id="data-table"><thead><tr><th>æ™‚é–“</th><th>å­¸ç”Ÿ</th><th>ç‹€æ…‹</th><th>ç­†è¨˜/ç•™è¨€</th><th>é¢¨éšª</th></tr></thead><tbody></tbody></table>
</div>

<script>
/* === Javascript é‚è¼¯ === */

const moodApp = {
  user: {},
  data: { emotion: null, intensity: 5, battery: 50, action: '', note: '', risk: null },
  history: [], 
  emotions: [
    { id: 'happy', label: 'é–‹å¿ƒ / èˆˆå¥®', weather:'æ™´æœ—', icon: 'ğŸ˜†', bg: 'linear-gradient(120deg, #f6d365 0%, #fda085 100%)', quote: "å¤ªæ£’äº†ï¼ä½ çš„å¿«æ¨‚æ˜¯é€™ä¸–ç•Œçš„ä¸€é“å…‰ï¼âœ¨", tip: "è©¦è‘—æŠŠä½ ä»Šå¤©ç™¼ç”Ÿçš„ä¸€ä»¶å¥½äº‹å¯«åœ¨ä¾¿æ¢ç´™ä¸Šï¼Œè²¼åœ¨æ›¸æ¡Œå‰ã€‚" },
    { id: 'calm', label: 'å¹³éœ / æ”¾é¬†', weather:'å¾®é¢¨', icon: 'ğŸ˜Œ', bg: 'linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%)', quote: "å¹³ç©©å°±æ˜¯åŠ›é‡ï¼Œäº«å—é€™ä»½å¯§éœå§ã€‚ğŸµ", tip: "è¶ç¾åœ¨å¿ƒå¾ˆéœï¼ŒèŠ±3åˆ†é˜å°ˆæ³¨å‘¼å¸ï¼ŒæŠŠé€™ä»½å¹³éœçš„æ„Ÿè¦ºè¨˜åœ¨å¤§è…¦è£¡ã€‚" },
    { id: 'warm', label: 'æº«æš– / è¢«æ„›', weather:'æš–é™½', icon: 'ğŸ¥°', bg: 'linear-gradient(120deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)', quote: "è¢«æ„›çš„æ„Ÿè¦ºçœŸå¥½ï¼ä½ ä¹Ÿå€¼å¾—é€™ä»½æº«æš–ã€‚â¤ï¸", tip: "æ¥æ”¶åˆ°æ„›ä¹‹å¾Œï¼Œè©¦è‘—æŠŠå®ƒå‚³å‡ºå»ã€‚å‚³å€‹è²¼åœ–çµ¦ä¸€å€‹ä½ ä¹Ÿæƒ³é—œå¿ƒçš„äººã€‚" },
    { id: 'tired', label: 'ç–²ç´¯ / ç„¡åŠ›', weather:'é™°å¤©', icon: 'ğŸ¤’', bg: 'linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)', quote: "è¾›è‹¦äº†ï¼Œæ²’é›»çš„æ™‚å€™å°±å…è¨±è‡ªå·±èººå¹³å§ã€‚ğŸ’¤", tip: "ã€ä½è€—èƒ½æ¨¡å¼ã€‘ ä»Šå¤©çš„ä»»å‹™å°±æ˜¯ã€Œæ”¾éè‡ªå·±ã€ã€‚å…è¨±è‡ªå·±ä»Šæ™šæ—©ç¡åŠå°æ™‚ã€‚" },
    { id: 'confused', label: 'å›°æƒ‘ / è¿·æƒ˜', weather:'èµ·éœ§', icon: 'ğŸ˜µâ€ğŸ’«', bg: 'linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%)', quote: "è¿·æƒ˜ä»£è¡¨ä½ åœ¨æ€è€ƒï¼Œç­”æ¡ˆæœƒæ…¢æ…¢æµ®ç¾çš„ã€‚ğŸ§­", tip: "ã€å¤§è…¦å¸è¼‰ã€‘ è…¦è¢‹å¤ªäº‚å—ï¼Ÿæ‹¿ä¸€å¼µç´™ï¼ŒæŠŠç…©æƒ±å…¨éƒ¨å¯«ä¸‹ä¾†ï¼Œç„¶å¾ŒæŠŠå®ƒæ‰æˆä¸€åœ˜ä¸Ÿé€²åƒåœ¾æ¡¶ã€‚" },
    { id: 'anxious', label: 'ç„¦æ…® / ç·Šå¼µ', weather:'é™£é›¨', icon: 'ğŸ˜–', bg: 'linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%)', quote: "æ·±å‘¼å¸... å¸æ°£... åæ°£... ä½ æ¯”æƒ³åƒä¸­æ›´å¼·å¤§ã€‚ğŸŒŠ", tip: "ã€è‘—åœ°ç·´ç¿’ã€‘ æ‰¾å‡ºæˆ¿é–“è£¡ 5 å€‹é¡è‰²ã€æ‘¸ 4 ç¨®è§¸æ„Ÿã€è½ 3 ç¨®è²éŸ³ã€‚" },
    { id: 'sad', label: 'é›£é / æƒ³å“­', weather:'æš´é›¨', icon: 'ğŸ˜¢', bg: 'linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)', quote: "çœ¼æ·šæ˜¯å¿ƒéˆçš„é›¨æ°´ï¼Œä¸‹éé›¨å¾Œæœƒæ¯”è¼ƒæ¸…æ¾ˆçš„ã€‚â˜”", tip: "ã€è´è¶æ“æŠ±ã€‘ é›™æ‰‹äº¤å‰æ”¾åœ¨èƒ¸å‰ï¼Œå·¦å³äº¤æ›¿è¼•è¼•æ‹æ‰“è‡ªå·±çš„è‚©è†€ã€‚" },
    { id: 'angry', label: 'ç”Ÿæ°£ / æ†¤æ€’', weather:'é›·é›»', icon: 'ğŸ˜¡', bg: 'linear-gradient(120deg, #ff0844 0%, #ffb199 100%)', quote: "ä½ çš„ç”Ÿæ°£æ˜¯æœ‰åŸå› çš„ï¼Œå…ˆè®“ç«æ°£é™æº«ä¸€ä¸‹ã€‚ğŸ”¥", tip: "ã€èƒ½é‡é‡‹æ”¾ã€‘ å»ç”¨åŠ›æçˆ†æ°£æ³¡ç´™ï¼Œæˆ–æ˜¯ç”¨åŠ›æ¡ç·Šæ‹³é ­ 5 ç§’å†ç¬é–“æ”¾é¬†ã€‚" },
    { id: 'boring', label: 'ç„¡èŠ / æ‚¶', weather:'å¤šé›²', icon: 'ğŸ¥±', bg: 'linear-gradient(to top, #d299c2 0%, #fef9d7 100%)', quote: "ç„¡èŠæˆ–è¨±æ˜¯å¤§è…¦æƒ³ä¼‘æ¯ï¼Œä¹Ÿæˆ–è¨±æ˜¯æƒ³æ‰¾æ¨‚å­ã€‚ğŸˆ", tip: "è©¦è‘—åšä¸€ä»¶å¹³å¸¸ä¸æœƒåšçš„å°äº‹ï¼šä¾‹å¦‚ç”¨å·¦æ‰‹åˆ·ç‰™ã€‚" }
  ],
  riskQuestions: [
    { text: 'ä¸æƒ³åƒæ±è¥¿ï¼Œæˆ–å£“åŠ›å¤§ä¸€ç›´ç‹‚åƒï¼Ÿ', score: 1 },
    { text: 'ç¡ä¸è‘—ã€å¾ˆæ—©é†’ï¼Œæˆ–æ˜¯ç¡å¾ˆä¹…éƒ½ç¡ä¸é£½ï¼Ÿ', score: 1 },
    { text: 'è¦ºå¾—å¿ƒæƒ…ä¸å¥½ã€æƒ³å“­ï¼Œæˆ–æ‚¶æ‚¶ä¸æ¨‚ï¼Ÿ', score: 1 },
    { text: 'è¦ºå¾—æ¯”ä»¥å‰æ›´å®¹æ˜“ç”Ÿæ°£ã€çœ‹ä»€éº¼éƒ½ä¸é †çœ¼ï¼Ÿ', score: 1 },
    { text: 'ä¸æƒ³è·Ÿåˆ¥äººèªªè©±ï¼Œä¸æƒ³å‡ºé–€ï¼Ÿ', score: 1 },
    { text: 'å°åŸæœ¬å–œæ­¡çš„äº‹ï¼ˆå¦‚ç¤¾åœ˜ã€é›»å‹•ï¼‰è®Šæ²’èˆˆè¶£ï¼Ÿ', score: 1 },
    { text: 'è¦ºå¾—èº«é«”å¾ˆä¸èˆ’æœï¼ˆé ­ç—›ã€è‚šå­ç—›ï¼‰ä½†æ‰¾ä¸åˆ°åŸå› ï¼Ÿ', score: 1 },
    { text: 'åšäº‹æä¸èµ·å‹ï¼Œè¦ºå¾—èº«é«”å¾ˆé‡ã€å¾ˆç´¯ï¼Ÿ', score: 1 },
    { text: 'è¦ºå¾—è‡ªå·±å¾ˆæ²’ç”¨ã€å¾ˆç³Ÿç³•ï¼Œæˆ–æ˜¯å°ä¸èµ·åˆ¥äººï¼Ÿ', score: 1 },
    { text: 'è…¦è¢‹ç©ºç©ºï¼Œä¸Šèª²å¾ˆé›£å°ˆå¿ƒï¼Œæˆ–æ˜¯è¨˜ä¸ä½äº‹æƒ…ï¼Ÿ', score: 1 },
    { text: 'æ›¾ç¶“æœ‰éã€Œæƒ³çµæŸç”Ÿå‘½ã€æˆ–ã€Œæƒ³æ¶ˆå¤±ã€çš„å¿µé ­ï¼Ÿ', isRedFlag: true }
  ],
  vitamins: [
    "ä½ ä¸éœ€è¦åšåˆ°å®Œç¾ï¼Œä½ åªéœ€è¦åšä½ è‡ªå·±ã€‚", "ä¼‘æ¯ä¸æ˜¯å·æ‡¶ï¼Œæ˜¯ç‚ºäº†èµ°æ›´é•·é çš„è·¯ã€‚",
    "æ¯ä¸€æœµèŠ±é–‹çš„æ™‚é–“éƒ½ä¸ä¸€æ¨£ï¼Œä½ ä¹Ÿä¸€æ¨£ã€‚", "é€™ä¹Ÿæœƒéå»çš„ï¼Œä½ æ¯”ä½ æƒ³åƒçš„é‚„è¦å …å¼·ã€‚",
    "ä»Šå¤©çš„ä½ ï¼Œå·²ç¶“åšå¾—å¾ˆå¥½äº†ã€‚", "å…è¨±è‡ªå·±æœ‰æƒ…ç·’ï¼Œé€™æ˜¯ç”Ÿè€Œç‚ºäººçš„æ¬Šåˆ©ã€‚",
    "åªè¦é‚„åœ¨å‘¼å¸ï¼Œå°±æœ‰æ”¹è®Šçš„å¯èƒ½ã€‚"
  ],
  peerQuotes: [
    "æˆ‘ä¹Ÿæ˜¯é€™æ¨£ï¼Œè€ƒå‰ç„¦æ…®åˆ°æƒ³åï¼Œä½†è€ƒå®Œå°±æ²’äº‹äº†ï¼", "é›–ç„¶ä¸èªè­˜ä½ ï¼Œä½†æƒ³è·Ÿä½ èªªè²åŠ æ²¹ã€‚",
    "æœ‰æ™‚å€™ï¼Œä»€éº¼éƒ½ä¸åšä¹Ÿæ˜¯ä¸€ç¨®é¸æ“‡ã€‚", "å“­å‡ºä¾†æ²’é—œä¿‚ï¼Œæˆ‘ä¸Šæ¬¡ä¹Ÿèº²åœ¨è¢«å­è£¡å“­ã€‚"
  ]
};

window.onload = function() {
  const savedData = localStorage.getItem('moodHistory_V17');
  if (savedData) {
    moodApp.history = JSON.parse(savedData);
    updateAdmin();
  }
  updateSlider(5);
  updateBattery(50);
};

/* === éŸ³æ¨‚æ§åˆ¶ === */
let isMusicPlaying = false;
function forcePlayMusic() {
  const bgm = document.getElementById('bgm');
  const icon = document.getElementById('music-icon');
  
  if (isMusicPlaying) {
    bgm.pause();
    icon.innerText = "ğŸ”‡";
    isMusicPlaying = false;
  } else {
    bgm.volume = 0.4;
    bgm.play().then(() => {
        icon.innerText = "ğŸµ";
        isMusicPlaying = true;
        showToast("æ’­æ”¾æº«æš–æ”¾é¬†éŸ³æ¨‚ â™ª");
    }).catch(e => {
        showToast("è«‹å…ˆé»æ“Šé é¢å†æ’­æ”¾éŸ³æ¨‚");
    });
  }
}

/* === ç¢ç´™æ©ŸåŠŸèƒ½ (ä¿®å¾©åŒæ­¥å•é¡Œ) === */
function playShredSound() {
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  if (!AudioContext) return;
  const ctx = new AudioContext();
  const bufferSize = ctx.sampleRate * 2.5; 
  const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i = 0; i < bufferSize; i++) {
    data[i] = Math.random() * 2 - 1;
  }
  const noise = ctx.createBufferSource();
  noise.buffer = buffer;
  const filter = ctx.createBiquadFilter();
  filter.type = 'lowpass';
  filter.frequency.value = 1000;
  const gainNode = ctx.createGain();
  gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 2.5);
  noise.connect(filter);
  filter.connect(gainNode);
  gainNode.connect(ctx.destination);
  noise.start();
}

function shredWorry() {
  const text = document.getElementById('worry-text').value;
  if (!text) return showToast("å¯«é»ä»€éº¼å†ä¸Ÿæ‰å§ï¼Ÿ");

  const overlay = document.getElementById('shredder-overlay');
  const paper = document.getElementById('paper-to-shred');
  const light = document.getElementById('shredder-light');
  const bgm = document.getElementById('bgm');
  const successOverlay = document.getElementById('success-overlay');
  
  paper.innerText = text;
  paper.classList.remove('shredding'); 
  overlay.style.display = 'flex'; 
  
  if(isMusicPlaying) bgm.pause();
  
  void paper.offsetWidth; 

  // 1. å…ˆé–‹å§‹ç´™å¼µå‹•ç•«
  setTimeout(() => {
    paper.classList.add('shredding'); 
  }, 100);

  // 2. å»¶é² 1.6 ç§’å¾Œ (ç´™å‰›å¥½ç¢°åˆ°ç¢ç´™æ©Ÿ)ï¼Œæ‰é–‹å§‹è²éŸ³èˆ‡ç‡ˆå…‰
  setTimeout(() => {
    light.classList.add('active'); 
    playShredSound();
    
    // 3. å™´å‡ºç´™å±‘
    setTimeout(() => {
        const count = 40; 
        for(let i=0; i<count; i++) {
            setTimeout(() => { createRealStrip(overlay); }, Math.random() * 1500); 
        }
    }, 200); 

  }, 1600);

  moodApp.data.note += ` [ç¢ç´™æ©Ÿ: ${text}]`; 
  document.getElementById('worry-text').value = ""; 

  // 4. å…¨éƒ¨çµæŸï¼Œé¡¯ç¤ºæˆåŠŸç•«é¢
  setTimeout(() => { 
    overlay.style.display = 'none'; 
    light.classList.remove('active');
    document.querySelectorAll('.shred-strip').forEach(el => el.remove());
    if(isMusicPlaying) bgm.play().catch(e => console.log(e));
    successOverlay.style.display = 'flex'; 
  }, 4500); 
}

function createRealStrip(container) {
  const strip = document.createElement('div');
  strip.className = 'shred-strip';
  const centerOffset = (Math.random() - 0.5) * 260; 
  strip.style.left = `calc(50% + ${centerOffset}px)`;
  strip.style.height = `${20 + Math.random() * 30}px`;
  strip.style.width = `${4 + Math.random() * 4}px`;
  strip.style.setProperty('--rot', `${(Math.random() - 0.5) * 720}deg`);
  strip.style.backgroundColor = Math.random() > 0.5 ? '#fff' : '#f0f0f0';
  strip.style.animation = `fallStrip ${1.5 + Math.random()}s cubic-bezier(0.25, 1, 0.5, 1) forwards`;
  container.appendChild(strip);
}

/* === åŸºæœ¬åŠŸèƒ½ === */
function updateSlider(val) {
  const t = document.getElementById('slider-text');
  t.innerText = `å¿ƒæƒ…å¼·åº¦ï¼š${val}`;
  t.style.color = val > 7 ? '#e53e3e' : '#8ba7d6';
  moodApp.data.intensity = val;
}

function updateBattery(val) {
  const fill = document.getElementById('battery-fill');
  const text = document.getElementById('battery-text');
  moodApp.data.battery = val;
  text.innerText = val + "%";
  fill.style.width = val + "%";
  fill.style.backgroundColor = val <= 30 ? '#e53e3e' : (val <= 60 ? '#ecc94b' : '#48bb78');
  text.style.color = fill.style.backgroundColor;
}

function startCheck() {
  const id = document.getElementById('sid').value;
  const name = document.getElementById('sname').value;
  if(!id || !name) return showToast("è«‹å…ˆè¼¸å…¥ç­ç´šèˆ‡å§“å (ã‚âˆ€ï½¥)");
  moodApp.user = { id, name };
  
  // === å®¢è£½åŒ–åç¨±å¸¶å…¥é‚è¼¯ ===
  // 1. ä¿®æ”¹é¦–é æ‹›å‘¼èª
  document.getElementById('greeting-text').innerHTML = `Hi <b style="color:var(--primary)">${name}</b>ï¼Œ<br>ç¾åœ¨çš„æ„Ÿè¦ºåƒä»€éº¼ï¼Ÿ`;
  
  // 2. ä¿®æ”¹èƒ½é‡é›»æ± æ¨™é¡Œ
  document.getElementById('battery-title').innerHTML = `âš¡ <b>${name}</b> çš„èƒ½é‡é›»æ±  (é«”åŠ›)ï¼š`;
  
  // 3. ä¿®æ”¹æœ€å¾Œç•™è¨€çš„å•å¥
  document.getElementById('final-prompt').innerHTML = `ğŸ’¬ <b>${name}</b>ï¼Œé‚„æƒ³è·Ÿè€å¸«èªªä»€éº¼å—ï¼Ÿ`;
  
  forcePlayMusic();
  switchStep(1);
  renderEmotions();
}

function renderEmotions() {
  const grid = document.getElementById('emotion-grid');
  grid.innerHTML = '';
  moodApp.emotions.forEach(e => {
    const btn = document.createElement('div');
    btn.className = 'btn-mood';
    btn.innerHTML = `<span class="emoji-icon">${e.icon}</span><span style="font-weight:700; color:#555;">${e.label}</span>`;
    btn.onclick = () => selectEmotion(e, btn);
    grid.appendChild(btn);
  });
}

function selectEmotion(emotion, btn) {
  moodApp.data.emotion = emotion;
  document.body.style.background = emotion.bg; 
  document.body.style.backgroundSize = "400% 400%";
  document.body.style.animation = "gradientBG 15s ease infinite";

  document.querySelectorAll('.btn-mood').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  document.getElementById('step2-title').innerHTML = `ä»Šæ—¥æ°£è±¡ï¼š${emotion.weather} ${emotion.icon}`;
  setTimeout(() => { switchStep(2); }, 300);
}

function processStep2() {
  moodApp.data.action = document.getElementById('small-step-note').value;
  moodApp.data.needTalk = document.getElementById('need-talk').checked;
  const negTypes = ['sad', 'anxious', 'angry', 'tired', 'confused'];
  if (negTypes.includes(moodApp.data.emotion.id) && moodApp.data.intensity >= 6) {
    renderRiskList();
    switchStep(3);
  } else {
    finish(false);
  }
}

function renderRiskList() {
  const list = document.getElementById('risk-list');
  list.innerHTML = '';
  moodApp.riskQuestions.forEach(q => {
    const item = document.createElement('label');
    item.className = 'risk-item';
    item.style.cssText = "background:rgba(255,255,255,0.8); padding:15px; border-radius:15px; border:1px solid rgba(226, 232, 240, 0.8); margin-bottom:10px; transition:0.2s; display:block; cursor:pointer;";
    const labelText = q.isRedFlag ? `<b style="color:#c53030">${q.text}</b>` : q.text;
    item.innerHTML = `<input type="checkbox" ${q.isRedFlag?'data-red="true"':''} style="margin-right:10px; transform:scale(1.2); accent-color:#e53e3e;"><span>${labelText}</span>`;
    
    item.onmouseover = () => { item.style.background = "#fff5f5"; item.style.borderColor = "#feb2b2"; };
    item.onmouseout = () => { item.style.background = "rgba(255,255,255,0.8)"; item.style.borderColor = "rgba(226, 232, 240, 0.8)"; };
    
    list.appendChild(item);
  });
}

function submitRisk() {
  let score = 0, isRed = false;
  document.querySelectorAll('#risk-list input:checked').forEach(cb => {
    score++; if(cb.dataset.red === "true") isRed = true;
  });
  const isHighRisk = isRed || score >= 5;
  moodApp.data.risk = { count: score, isRed, isHigh: isHighRisk };
  finish(isHighRisk);
}

function finish(isHighRisk) {
  const { emotion } = moodApp.data;
  const resultDiv = document.getElementById('result-area');
  saveData(isHighRisk);
  
  const randomPeer = moodApp.peerQuotes[Math.floor(Math.random() * moodApp.peerQuotes.length)];
  document.getElementById('tree-hole-msg').innerText = `"${randomPeer}"`;

  // === å®¢è£½åŒ–åç¨±å¸¶å…¥çµæœé  ===
  const greetingName = `<b>${moodApp.user.name}</b>`;

  if (isHighRisk) {
    resultDiv.innerHTML = `
      <div style="background:#fff5f5; border:2px solid #fc8181; border-radius:20px; padding:20px; text-align:center;">
        <h3 style="color:#c53030; margin:0;">ğŸ›‘ æˆ‘å€‘éå¸¸é‡è¦–ä½ çš„æ„Ÿå—</h3>
        <p style="color:#4a5568; margin-top:10px;">ç³»çµ±æ³¨æ„åˆ° ${greetingName} çš„å£“åŠ›æŒ‡æ•¸è¼ƒé«˜ï¼Œ<br>å»ºè­°ä½ å°‹æ±‚ä¿¡ä»»çš„å¤§äººå€‘ã€è¼”å°å®¤å¹«å¿™æˆ–èŠèŠã€‚<br>
        <br>âš å¦‚æœä½ çš„ç—›è‹¦å·²ç¶“å¿«å£“å®ä½ ï¼Œç”šè‡³è®“ä½ æƒ³ã€Œé›¢é–‹ä¸–ç•Œã€<br>
        è«‹é¦¬ä¸Šæ‰¾ä¿¡ä»»çš„äººæ±‚åŠ©ï¼æˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ’¥æ‰“ç”Ÿå‘½ç·šï¼</p>

        <a href="tel:1995" style="display:inline-block; background:#e53e3e; color:white; text-decoration:none; padding:10px 20px; border-radius:50px; font-weight:bold; margin-top:10px;">ğŸ“ 1995 ç”Ÿå‘½ç·š</a>
      </div>`;
  } else {
    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, colors: ['#ff9a9e', '#fad0c4', '#a18cd1'] });
    resultDiv.innerHTML = `
      <h2 style="color:var(--primary)">æ”¶åˆ° ${greetingName} çš„å¿ƒæƒ…äº† (Â´â–½\`Êƒâ™¡Æª)</h2>
      <p style="text-align:center; font-style:italic; color:#718096;">"${emotion.quote}"</p>
      <div style="background:#f0fff4; border:2px dashed #68d391; border-radius:20px; padding:15px; margin-top:15px; display:flex; align-items:center; gap:10px;">
        <div style="font-size:2rem;">ğŸ</div>
        <div>
          <h4 style="margin:0 0 5px 0; color:#2f855a;">çµ¦ä½ çš„å°å°ä»»å‹™</h4>
          <div style="color:#276749; font-size:0.95rem;">${emotion.tip}</div>
        </div>
      </div>`;
  }
  switchStep(4);
}

function drawVitamin() {
  const container = document.getElementById('vitamin-section');
  if(container.querySelector('.vitamin-inner').style.transform === 'rotateY(180deg)') return;
  const textEl = document.getElementById('vitamin-text');
  const randomMsg = moodApp.vitamins[Math.floor(Math.random() * moodApp.vitamins.length)];
  textEl.innerText = randomMsg;
  container.querySelector('.vitamin-inner').style.transform = 'rotateY(180deg)';
  confetti({ particleCount: 30, spread: 50, origin: { y: 0.7 }, scalar: 0.7 });
}

function sendFinalMsg(btn) {
  const msg = document.getElementById('final-msg').value;
  if(!msg) return showToast("å…§å®¹æ˜¯ç©ºçš„å–”ï½");
  
  const lastIdx = moodApp.history.length - 1;
  if(lastIdx >= 0) {
    moodApp.history[lastIdx].note += ` [ç•™è¨€: ${msg}]`;
    localStorage.setItem('moodHistory_V17', JSON.stringify(moodApp.history));
  }
  updateAdmin();
  const updateData = {
    action: "append_note", // é€™æ˜¯é€šé—œå¯†èª
    student: `${moodApp.user.id} ${moodApp.user.name}`,
    note: `[ç•™è¨€: ${msg}]`,
    time: new Date().toLocaleString()
  };

  // ç™¼å°„ï¼
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(updateData)
  })
  .then(() => {
    alert("ç•™è¨€å·²è£œå……çµ¦è€å¸«å›‰ï¼(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§");
    if(btn) btn.disabled = true; // é˜²æ­¢é‡è¤‡æŒ‰
    document.getElementById('final-msg').value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
  })
  .catch(err => {
    console.error("é›²ç«¯è£œç•™è¨€å¤±æ•—", err);
    alert("ç•™è¨€å­˜åœ¨æœ¬åœ°äº†ï¼Œä½†é›²ç«¯é€£ç·šæ€ªæ€ªçš„ï½");
  });
  
  // é¡¯ç¤ºå…¨è¢å¹•æ„Ÿè¬å‹•ç•«
  document.getElementById('final-thank-you-overlay').style.display = 'flex';
}

/* === è³‡æ–™å­˜å– (V6.0 é›²ç«¯åŒæ­¥ç‰ˆ) === */
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwWQOxG_LN3QnBa7LY_YDZa07aRtwCC9pFDVcN6VvZeEgi7Q4p4oq9GuBoU9jBYZsRNFA/exec"; // <--- è¨˜å¾—è²¼ä¸Šï¼

function saveData(isHighRisk) {
  // --- 1. æº–å‚™è³‡æ–™ (é‚è¼¯ä¸è®Š) ---
  let riskLabel = "ğŸŸ¢ ä¸€èˆ¬";
  if (moodApp.data.risk) {
    if (moodApp.data.risk.isRed) riskLabel = "ğŸ”´ å±éšª";
    else if (moodApp.data.risk.isHigh) riskLabel = "ğŸŸ  é«˜é—œæ‡·";
    else riskLabel = "ğŸŸ¡ æœ‰å›°æ“¾";
  }

  let finalNote = moodApp.data.note || "";
  if(moodApp.data.needTalk) finalNote = "[æ±‚åŠ©] " + finalNote;

  // å»ºç«‹è¦å­˜æª”çš„ç‰©ä»¶
  let record = {
    time: new Date().toLocaleString(),
    student: `${moodApp.user.id} ${moodApp.user.name}`,
    emotion: moodApp.data.emotion ? moodApp.data.emotion.label : "æœªé¸æ“‡",
    intensity: Number(moodApp.data.intensity) || 0,
    battery: Number(moodApp.data.battery) || 0,
    action: moodApp.data.action || "ç„¡",
    risk: riskLabel,
    note: finalNote
  };

  // --- 2. æœ¬åœ°å­˜æª” (åŸæœ¬çš„åŠŸèƒ½) ---
  moodApp.history.push(record);
  localStorage.setItem('moodHistory_V17', JSON.stringify(moodApp.history));
  updateAdmin();

  // --- 3. ç™¼å°„åˆ° Google é›²ç«¯ (æ–°å¢çš„åŠŸèƒ½) ---
  // ä½¿ç”¨ fetch ç™¼é€è«‹æ±‚
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors", // é€™æ˜¯é—œéµï¼é¿é–‹ç€è¦½å™¨çš„è·¨åŸŸæª¢æŸ¥
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(record)
  })
  .then(() => {
    console.log("é›²ç«¯å‚™ä»½æˆåŠŸï¼");
    // å¯ä»¥åœ¨é€™è£¡åŠ å€‹å°æç¤ºï¼Œä¾‹å¦‚ Toast
  })
  .catch(err => {
    console.error("é›²ç«¯ä¸Šå‚³å¤±æ•—ï¼š", err);
    alert("âš ï¸ æ³¨æ„ï¼šé›²ç«¯å‚™ä»½å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚ä½†æœ¬åœ°ç´€éŒ„å·²ä¿å­˜ã€‚");
  });

  // æç¤ºæˆåŠŸ (æœ¬åœ°)
  alert("ç´€éŒ„å·²å„²å­˜ï¼(åŒæ­¥ä¸Šå‚³ä¸­...)");
}

/* === å¾Œå°ç®¡ç† (V5.1 å…¨æ¬„ä½é¡¯ç¤ºç‰ˆ) === */
function updateAdmin() {
  // 1. å…ˆä¿®æ­£è¡¨é ­ (ç¢ºä¿ä¸Šæ–¹æ¨™é¡Œè·Ÿä¸‹æ–¹è³‡æ–™å°é½Š)
  const thead = document.querySelector('#data-table thead tr');
  if(thead) {
    thead.innerHTML = `
      <th>æ™‚é–“</th>
      <th>å­¸ç”Ÿ</th>
      <th>æƒ…ç·’</th>
      <th>å¼·åº¦</th>
      <th>é›»é‡</th>
      <th>è¡Œå‹•</th>
      <th>ç•™è¨€</th>
      <th>é¢¨éšª</th>
    `;
  }

  // 2. æ›´æ–°è¡¨æ ¼å…§å®¹
  const tbody = document.querySelector('#data-table tbody');
  tbody.innerHTML = '';
  
  [...moodApp.history].reverse().forEach(r => {
    const tr = document.createElement('tr');
    
    // é¢¨éšªé«˜äº®é¡¯ç¤ºé‚è¼¯
    if (r.risk && (r.risk.includes('ğŸ”´') || r.risk.includes('ğŸŸ '))) {
      tr.className = 'high-risk-row';
    } else if (r.note && r.note.includes('[æ±‚åŠ©]')) {
      tr.className = 'high-risk-row';
    }

    // é˜²å‘†è™•ç†ï¼šèˆŠè³‡æ–™å¯èƒ½æ²’æœ‰é€™äº›æ¬„ä½ï¼Œçµ¦å€‹é è¨­å€¼
    const valIntensity = r.intensity !== undefined ? r.intensity : "-";
    const valBattery = r.battery !== undefined ? r.battery + "%" : "-";
    const valAction = r.action || "-";

    // å¡«å…¥ 8 å€‹æ¬„ä½ (å°æ‡‰ä¸Šé¢çš„è¡¨é ­)
    tr.innerHTML = `
      <td>${r.time}</td>
      <td>${r.student}</td>
      <td>${r.emotion}</td>
      <td style="text-align:center; font-weight:bold; color:#555;">${valIntensity}</td>
      <td style="text-align:center; color:#2b6cb0;">${valBattery}</td>
      <td style="font-size:0.9em;">${valAction}</td>
      <td>${r.note}</td>
      <td>${r.risk}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* === åŒ¯å‡º Excel åŠŸèƒ½ === */
function downloadCSV() {
  let csvContent = "\uFEFFæ™‚é–“,å­¸ç”Ÿ,æƒ…ç·’,å¼·åº¦,é›»é‡,è¡Œå‹•,é¢¨éšª,ç•™è¨€\n";
  
  moodApp.history.forEach(row => {
    let r_note = `"${(row.note || "").replace(/"/g, '""')}"`; // è™•ç†é€—è™Ÿèˆ‡å¼•è™Ÿ
    csvContent += `${row.time},${row.student},${row.emotion},${row.intensity},${row.battery},${row.action},${row.risk},${r_note}\n`;
  });

  const link = document.createElement("a");
  link.href = "data:text/csv;charset=utf-8," + encodeURI(csvContent);
  link.download = "ç¦ç§‘å¿ƒæƒ…æ•¸æ“š.csv";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function switchStep(n) {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById('step-'+n).classList.add('active');
  document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i <= n));
  window.scrollTo(0, 0);
}

function toggleAdmin() {
  const p = document.getElementById('admin-panel');
  if(p.style.display === 'block') { p.style.display = 'none'; } 
  else {
    if(prompt("é­”é¡ã„šé­”é¡ï¼Œèª°æ˜¯ä¸–ç•Œä¸Šæœ€å¸¥çš„è€å¸«ï¼Ÿ")==='1017') {
      p.style.display = 'block';
      if(!document.getElementById('btn-clear')) {
          const btn = document.createElement('button');
          btn.id = 'btn-clear';
          btn.innerText = "æ¸…ç©ºè³‡æ–™åº«";
          btn.style = "background:#c53030; color:white; border:none; padding:5px; margin-left:10px;";
          btn.onclick = () => {
             if(confirm("ç¢ºå®šåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼Ÿ")) {
                 moodApp.history = [];
                 localStorage.removeItem('moodHistory_V17');
                 updateAdmin();
             }
          };
          document.querySelector('#admin-panel h3').appendChild(btn);
      }
    }
  }
}

function showToast(msg) {
  const t = document.getElementById("toast");
  t.innerText = msg; t.className = "show";
  setTimeout(() => t.className = "", 3000);
}
</script>
<style>
  /* 1. èƒŒæ™¯é®ç½©ï¼šé»‘åº•åŠé€æ˜ï¼Œå¼·åˆ¶è“‹ä½æ‰€æœ‰å…§å®¹ */
  #consent-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* æ·±é»‘è‰²èƒŒæ™¯ï¼Œä¸è®“çœ‹å¾Œé¢ */
    z-index: 99999; /* ç¢ºä¿å±¤ç´šæœ€é«˜ï¼Œè“‹éæ‰€æœ‰åŸæœ¬ç¶²é  */
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœï¼Œå¢åŠ è³ªæ„Ÿ */
  }

  /* 2. è²æ˜å¡ç‰‡æœ¬é«” */
  .consent-card {
    background: #fae6f2b0;
    width: 90%;
    max-width: 500px; /* é›»è…¦ç‰ˆæœ€å¤§å¯¬åº¦ */
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
   font-family: 'Zen Maru Gothic', "Microsoft JhengHei", sans-serif;
    font-weight: 500; /* ç¨å¾®åŠ ç²—ï¼Œåƒéº¥å…‹ç­† */
    letter-spacing: 0.5px; /* å­—è·å¯¬ä¸€é»ï¼Œæ¯”è¼ƒè¼•é¬† */
    
    text-align: left;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    border-top: 6px solid #ac06069d;
  }

  /* 3. æ¨™é¡Œèˆ‡å…§æ–‡æ¨£å¼ */
  .consent-title {
    font-size: 1.4rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
    text-align: center;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
  }
  
  .consent-body p {
    font-size: 1rem;
    color: #444;
    line-height: 1.6;
    margin-bottom: 12px;
  }

  .consent-highlight {
    background-color: #fff3cd;
    padding: 2px 5px;
    border-radius: 3px;
    font-weight: bold;
    color: #856404;
  }

  .consent-alert {
    color: #e74c3c;
    font-weight: bold;
  }

  /* 4. æŒ‰éˆ•æ¨£å¼ */
  .consent-btn-area {
    margin-top: 20px;
    text-align: center;
  }

  #agree-btn {
    background-color: #ccc; /* ä¸€é–‹å§‹ç°è‰²ï¼Œä¸èƒ½æŒ‰ */
    color: white;
    border: none;
    padding: 12px 30px;
    font-size: 1rem;
    border-radius: 50px;
    cursor: not-allowed;
    transition: all 0.3s ease;
    width: 100%;
    font-weight: bold;
    pointer-events: none; /* ç¦æ­¢é»æ“Š */
  }

  /* å•Ÿç”¨ç‹€æ…‹çš„æŒ‰éˆ• (ç”± JS æ§åˆ¶) */
  #agree-btn.active {
    background-color: #145730; /* ç¶ è‰² */
    cursor: pointer;
    pointer-events: auto;
    box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
  }
  
  #agree-btn.active:hover {
    background-color: #0c331c;
  }

</style>

<div id="consent-overlay">
  <div class="consent-card">
    <div class="consent-title">ğŸ“‹ é–‹å§‹ä½¿ç”¨å‰è«‹å…ˆè®€æˆ‘</div>
    
   <div class="consent-body">
      <p>æ­¡è¿ä¾†åˆ°ç¦ç§‘å¿ƒéˆæ¨¹æ´ï¼ç‚ºäº†ä¿è­·ä½ ï¼Œè«‹ç¢ºèªä»¥ä¸‹å¹¾é»ï¼š</p>
      
      <p><strong>1. âš ï¸ é€™ä¸æ˜¯å³æ™‚æ±‚åŠ©ç³»çµ±</strong><br>
      è€å¸«å¯èƒ½ç„¡æ³•ç«‹åˆ»å›è¦†ã€‚å¦‚æœä½ ç¾åœ¨æƒ³å‚·å®³è‡ªå·±æˆ–åˆ¥äººï¼Œè«‹<span class="consent-alert">ç«‹åˆ»æ”¾ä¸‹æ‰‹æ©Ÿï¼Œç›´æ¥æ‰¾è¼”å°å®¤è€å¸«æˆ–æ’¥æ‰“ 113 / 1925</span>ã€‚</p>
      
      <p><strong>2. ğŸ”’ ä¿å¯†æœ‰ä¾‹å¤–</strong><br>
      æˆ‘å€‘æœƒä¿è­·éš±ç§ï¼Œä½†è‹¥æ¶‰åŠ<span class="consent-highlight">ç”Ÿå‘½å±éšªã€æ€§å¹³æˆ–æ³•å¾‹è¦å®š</span>ï¼Œæˆ‘å€‘å¿…é ˆé€šå ±ä»¥ä¿è­·ä½ çš„å®‰å…¨ã€‚</p>
      
      <p><strong>3. ğŸ†” è«‹ç”¨çœŸå¯¦èº«åˆ†</strong><br>
      è«‹å‹¿å†’ç”¨ä»–äººï¼Œå¦å‰‡æˆ‘å€‘ç„¡æ³•æä¾›å”åŠ©ã€‚</p>

 <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">
      
      <p style="font-size: 0.9rem; color: #666; text-align: center;">
        é»æ“Šä¸‹æ–¹æŒ‰éˆ•å³ä»£è¡¨ä½ åŒæ„ä»¥ä¸Šå…§å®¹ã€‚
      </p>
<div class="consent-btn-area">
      <button id="agree-btn">è«‹é–±è®€å…§å®¹ (5)</button>
    </div>

      <div style="background-color: #ebd6d6; padding: 20px; margin: 15px 0; border-radius: 10px; text-align: center;">
        <p style="margin: 0 0 8px 0; color: #333; font-weight: bold; font-size: 1.1rem;">
            ğŸ¤– å®³ç¾æ‰¾è€å¸«ï¼Ÿè©¦è©¦ã€Œå°æœåŒå­¸ã€
        </p>
        <p style="margin: 0 0 15px 0; color: #666; font-size: 0.95rem;">
            æœ‰äº›è©±ä¸é©åˆå‘Šè¨´åˆ¥äººï¼Œè‡ªå·±æ†‹è‘—åˆå¥½é›£å—ï¼Ÿ<br>
            è©¦è©¦ä½ çš„ AI å¤¥ä¼´ï¼Œé™ªä½ èŠå¤©ã€è½ä½ èªªå¿ƒäº‹â¤
        </p>
        
        <a href="https://gemini.google.com/gem/1tVewN2AZmRwPpQxYZdt4G8x3P_oI_X4-?usp=sharing" target="_blank" style="display:inline-block; background-color:#ec8e8e; color:white; text-decoration:none; padding:8px 25px; border-radius:50px; font-size:0.95rem; font-weight:bold; box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3); transition: transform 0.2s;">
          ğŸ‘‰ é»æˆ‘æ‰¾å°æœåŒå­¸èŠå¤©
        </a>
      </div>
      
     
    </div>

    
  </div>
</div>

<script>
  // æœçš„è²¼èº«åŠ©ç† - é‚è¼¯æ§åˆ¶å€
  (function() {
    const btn = document.getElementById('agree-btn');
    const overlay = document.getElementById('consent-overlay');
    let timeLeft = 5; // å¼·åˆ¶é–±è®€ç§’æ•¸ï¼š5ç§’

    // 1. å€’æ•¸è¨ˆæ™‚é‚è¼¯ (é¿å…å­¸ç”Ÿçœ‹éƒ½ä¸çœ‹ç›´æ¥æŒ‰æ‰)
    const timer = setInterval(() => {
      timeLeft--;
      if (timeLeft > 0) {
        btn.innerText = `è«‹é–±è®€å…§å®¹ (${timeLeft})`;
      } else {
        clearInterval(timer);
        btn.innerText = "æˆ‘ç­è§£ä¸¦åŒæ„ï¼Œé€²å…¥æ¨¹æ´ > <";
        btn.classList.add('active'); // è®Šç¶ è‰²
      }
    }, 1000);

    // 2. é»æ“ŠåŒæ„å¾Œçš„å‹•ä½œ
    btn.addEventListener('click', function() {
      // é€™è£¡ä½¿ç”¨ sessionStorageï¼Œä»£è¡¨ã€Œé€™æ¬¡ç€è¦½å™¨æ²’é—œé–‰å‰ã€ç®—åŒæ„éä¸€æ¬¡
      // å¦‚æœä½ æƒ³ã€Œæ¯æ¬¡é‡æ–°æ•´ç†é é¢ã€éƒ½è¦è·³å‡ºä¾†ï¼Œå°±æŠŠä¸‹é¢é€™è¡Œè¨»è§£æ‰
      sessionStorage.setItem('du_consent_agreed', 'true');
      
      // æ·¡å‡ºæ•ˆæœ
      overlay.style.opacity = '0';
      overlay.style.transition = 'opacity 0.5s ease';
      
      // ç§»é™¤å…ƒç´ 
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 500);
    });

    // 3. (é¸ç”¨) æª¢æŸ¥æ˜¯å¦å·²ç¶“åŒæ„éï¼Ÿ
    // å¦‚æœä½ å¸Œæœ›å­¸ç”Ÿã€Œåªè¦ç€è¦½å™¨æ²’é—œï¼Œè·³åˆ°åˆ¥é å†å›ä¾†é¦–é ã€ä¸ç”¨é‡çœ‹ï¼Œå°±ä¿ç•™é€™æ®µã€‚
    // å¦‚æœä½ å¸Œæœ›ã€Œä¸ç®¡æ€æ¨£æ¯æ¬¡å›é¦–é éƒ½è¦é‡çœ‹ã€ï¼Œè«‹æŠŠä¸‹é¢é€™ä¸‰è¡Œåˆªæ‰ (Delete)ã€‚
    if (sessionStorage.getItem('du_consent_agreed') === 'true') {
       // overlay.style.display = 'none'; // é€™ä¸€è¡Œè§£é™¤è¨»è§£å°±æœƒå•Ÿç”¨ã€Œè¨˜æ†¶åŠŸèƒ½ã€
    }

  })();
</script>
</body>
</html>